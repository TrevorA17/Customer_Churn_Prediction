---
title: "Customer Churn Prediction"
author: "134780 Trevor Okinda"
date: "April 2024"
output:
  github_document: 
    toc: yes
    toc_depth: 4
    fig_width: 6
    fig_height: 4
    df_print: default
editor_options:
  chunk_output_type: console
---

# Student Details

|                                              |     |
|----------------------------------------------|-----|
| **Student ID Number**                        | 134780 |
| **Student Name**                             | Trevor Okinda |
| **BBIT 4.2 Group**                           | C |
| **Project Name**                             | Customer Churn Prediction Model |

# Setup Chunk

**Note:** the following KnitR options have been set as the global defaults: <BR> `knitr::opts_chunk$set(echo = TRUE, warning = FALSE, eval = TRUE, collapse = FALSE, tidy = TRUE)`.

More KnitR options are documented here <https://bookdown.org/yihui/rmarkdown-cookbook/chunk-options.html> and here <https://yihui.org/knitr/options/>.

```{r setup, include=FALSE}
library(formatR)
knitr::opts_chunk$set(
  warning = FALSE,
  collapse = FALSE
)
```

```{r Load Dataset}
# Load dataset
churn_data <- read.csv("Telco_customer_churn.csv", colClasses = c(
  CustomerID = "character",
  Count = "factor",
  Country = "factor",
  State = "factor",
  City = "factor",
  Zip_Code = "factor",
  Lat_Long = "character",
  Latitude = "numeric",
  Longitude = "numeric",
  Gender = "factor",
  Senior_Citizen = "factor",
  Partner = "factor",
  Dependents = "factor",
  Tenure_Months = "numeric",
  Phone_Service = "factor",
  Multiple_Lines = "factor",
  Internet_Service = "factor",
  Online_Security = "factor",
  Online_Backup = "factor",
  Device_Protection = "factor",
  Tech_Support = "factor",
  Streaming_TV = "factor",
  Streaming_Movies = "factor",
  Contract = "factor",
  Paperless_Billing = "factor",
  Payment_Method = "factor",
  Monthly_Charges = "numeric",
  Total_Charges = "numeric",
  Churn_Label = "factor",
  Churn_Value = "numeric",
  Churn_Score = "numeric",
  CLTV = "numeric",
  Churn_Reason = "factor"
))

# Display the structure of the dataset
str(churn_data)

# View the first few rows of the dataset
head(churn_data)

View(churn_data)
```

```{r Measures of Frequency}
#Measures of Frequency
# Load dataset (assuming it's already loaded as churn_data)

# Define categorical variables
categorical_vars <- c("Count", "Country", "State", "City", "Zip_Code", 
                      "Gender", "Senior_Citizen", "Partner", "Dependents",
                      "Phone_Service", "Multiple_Lines", "Internet_Service",
                      "Online_Security", "Online_Backup", "Device_Protection",
                      "Tech_Support", "Streaming_TV", "Streaming_Movies",
                      "Contract", "Paperless_Billing", "Payment_Method",
                      "Churn_Label", "Churn_Reason")

# Generate measures of frequency for each categorical variable
for (var in categorical_vars) {
  cat(paste("Frequency table for variable:", var, "\n"))
  print(table(churn_data[[var]]))
  cat("\n")
}
```

```{r Measures of Central Tendency}
# Measures of central tendency
# Define numerical variables
numerical_vars <- c("Tenure_Months", "Monthly_Charges", "Total_Charges", 
                    "Churn_Value", "Churn_Score", "CLTV")

# Generate measures of central tendency for each numerical variable
for (var in numerical_vars) {
  cat(paste("Measures of central tendency for variable:", var, "\n"))
  print(summary(churn_data[[var]]))
  cat("\n")
}
```

```{r Measures of Distribution}
#Measures of Distribution

# Load required package
library(e1071)

# Define numerical variables
numerical_vars <- c("Tenure_Months", "Monthly_Charges", "Total_Charges", 
                    "Churn_Value", "Churn_Score", "CLTV")

# Generate measures of distribution for each numerical variable
for (var in numerical_vars) {
  cat(paste("Measures of distribution for variable:", var, "\n"))
  cat("Skewness:", skewness(churn_data[[var]]), "\n")
  cat("Kurtosis:", kurtosis(churn_data[[var]]), "\n")
  cat("\n")
}
```

```{r Measures of Relationship}
# Measures of Relationship

# Load required package
library(MASS)  # For the chi-square test

# Define variables
numerical_vars <- c("Tenure_Months", "Monthly_Charges", "Total_Charges", 
                    "Churn_Value", "Churn_Score", "CLTV")

categorical_vars <- c("Count", "Country", "State", "City", "Zip_Code", 
                      "Gender", "Senior_Citizen", "Partner", "Dependents",
                      "Phone_Service", "Multiple_Lines", "Internet_Service",
                      "Online_Security", "Online_Backup", "Device_Protection",
                      "Tech_Support", "Streaming_TV", "Streaming_Movies",
                      "Contract", "Paperless_Billing", "Payment_Method",
                      "Churn_Label", "Churn_Reason")

# Compute measures of relationship for numerical variables (correlation)
cat("Correlation coefficients for numerical variables:\n")
correlation_matrix <- cor(churn_data[, numerical_vars])
print(correlation_matrix)

# Compute measures of relationship for categorical variables (chi-square test)
for (var in categorical_vars) {
  cat(paste("Chi-square test for variable:", var, "\n"))
  cross_tab <- table(churn_data[[var]], churn_data$Churn_Label)
  chi_square_test <- chisq.test(cross_tab)
  print(chi_square_test)
  cat("\n")
}
```

```{r ANOVA}
# ANOVA
# Define the categorical variable (factor)
categorical_var <- "Contract"  

# Define the numerical variable (response)
numerical_var <- "Monthly_Charges"  

# Perform ANOVA
anova_result <- aov(churn_data[[numerical_var]] ~ churn_data[[categorical_var]])

# Summarize ANOVA results
summary(anova_result)

```

```{r Missingness}
# Missing Values

# Check for missing values in the dataset
missing_values <- colSums(is.na(churn_data))

# Display columns with missing values
cols_with_missing <- names(missing_values[missing_values > 0])
print(cols_with_missing)

# Summarize the count of missing values for each column
print(missing_values)
```

```{r Imputation}
# Perform mean imputation for each column with missing values
for (col in cols_with_missing) {
  mean_value <- mean(churn_data[[col]], na.rm = TRUE)  # Compute mean of the column
  churn_data[[col]][is.na(churn_data[[col]])] <- mean_value  # Replace missing values with mean
}

# Verify that missing values have been imputed
missing_values_after_imputation <- colSums(is.na(churn_data))
print(missing_values_after_imputation)
```

```{r Transformation}
# Data Transformation
# Identify factor variables with only one level
factor_vars <- sapply(churn_data, is.factor)
single_level_vars <- names(churn_data)[sapply(churn_data[factor_vars], function(x) length(unique(x)) == 1)]

# Print variables with only one level
print(single_level_vars)

# Transform factor variables with only one level to numeric
for (var in single_level_vars) {
  churn_data[[var]] <- as.numeric(churn_data[[var]])
}
```

